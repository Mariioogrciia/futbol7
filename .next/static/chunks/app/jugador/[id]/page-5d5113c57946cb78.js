(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[819],{3941:(e,a,t)=>{"use strict";t.d(a,{N:()=>r});let r=(0,t(35497).UU)("https://aknyrfoxlpphebkfomwx.supabase.co","sb_publishable_Z36O_vV2RpFxkajpCPpU7w_D9ve-o3k")},13697:(e,a,t)=>{"use strict";t.d(a,{EditableStats:()=>h});var r=t(95155),s=t(12115),o=t(20063);let l=(0,t(71847).A)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var i=t(65229),n=t(35299),c=t(46046),d=t(3941),u=t(18720);function h(e){let{jugadorId:a,canEdit:t,initialStats:h}=e,[m,f]=(0,s.useState)(!1),[b,x]=(0,s.useState)(h),[g,v]=(0,s.useState)(!1),[y,j]=(0,s.useState)(!1),w=(0,o.useRouter)();(0,s.useEffect)(()=>{(async()=>{let{data:{session:e}}=await d.N.auth.getSession();if(e){let{data:t}=await d.N.from("usuarios").select("rol, jugador_id").eq("id",e.user.id).single();((null==t?void 0:t.rol)==="admin"||(null==t?void 0:t.jugador_id)===a)&&j(!0)}})()},[a]);let N=[{label:"Ritmo",value:b.ritmo},{label:"Tiro",value:b.tiro},{label:"Pase",value:b.pase},{label:"Regate",value:b.regate},{label:"Defensa",value:b.defensa},{label:"F\xedsico",value:b.fisico}],k=async()=>{v(!0);try{let{data:{session:e}}=await d.N.auth.getSession();if(!e)throw Error("No est\xe1s autenticado");let t=await fetch("/api/players/stats",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.access_token)},body:JSON.stringify({jugador_id:a,stats:b})});if(!t.ok){let e=await t.json();throw Error(e.error||"Error al actualizar estad\xedsticas")}u.o.success("Estad\xedsticas actualizadas con \xe9xito"),f(!1),w.refresh()}catch(e){console.error(e),u.o.error(e.message||"Error al guardar")}finally{v(!1)}};return(0,r.jsxs)("div",{className:"relative w-full",children:[y&&!m&&(0,r.jsx)("div",{className:"absolute top-0 right-0 z-10",children:(0,r.jsxs)("button",{onClick:()=>f(!0),className:"flex items-center gap-2 bg-primary/10 hover:bg-primary/20 text-primary border border-primary/30 px-4 py-2 rounded-full text-sm font-bold transition-all shadow-sm",children:[(0,r.jsx)(l,{className:"h-4 w-4"})," Editar"]})}),m?(0,r.jsxs)("div",{className:"bg-card rounded-2xl p-6 border border-border mt-4 w-full animate-in fade-in slide-in-from-top-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6 border-b border-border pb-4",children:[(0,r.jsx)("h4",{className:"text-xl font-bold flex items-center gap-2",children:"Ajustar Estad\xedsticas"}),(0,r.jsx)("button",{onClick:()=>{f(!1),x(h)},className:"text-muted-foreground hover:text-foreground p-2 rounded-full hover:bg-secondary",children:(0,r.jsx)(i.A,{className:"h-5 w-5"})})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 mb-8 pt-2",children:Object.entries(b).map(e=>{let[a,t]=e;return(0,r.jsxs)("div",{className:"space-y-3 p-4 bg-muted/50 rounded-xl border border-border/50",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("label",{className:"text-sm font-bold uppercase tracking-widest text-foreground capitalize",children:a}),(0,r.jsx)("span",{className:"text-xl font-black text-primary bg-primary/10 px-3 py-1 rounded-md min-w-[3rem] text-center",children:t})]}),(0,r.jsx)("input",{type:"range",min:"1",max:"99",value:t,onChange:e=>x(t=>({...t,[a]:parseInt(e.target.value)})),className:"w-full accent-primary h-2 bg-secondary rounded-lg appearance-none cursor-pointer"})]},a)})}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-border",children:[(0,r.jsx)("button",{onClick:()=>{f(!1),x(h)},className:"px-6 py-3 rounded-xl border border-border hover:bg-secondary font-medium transition-colors",children:"Cancelar"}),(0,r.jsxs)("button",{onClick:k,disabled:g,className:"bg-primary hover:bg-primary/90 text-primary-foreground px-8 py-3 rounded-xl font-bold flex items-center gap-2 transition-all shadow-md disabled:opacity-50",children:[g?(0,r.jsx)(n.A,{className:"animate-spin h-5 w-5"}):(0,r.jsx)(c.A,{className:"h-5 w-5"}),"Guardar"]})]})]}):(0,r.jsx)("div",{className:"bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-accent/5 via-background to-background rounded-3xl p-8 border border-border shadow-inner",children:(0,r.jsx)(p,{data:N})})]})}function p(e){let{data:a}=e,t=a.map((e,t)=>{let r=2*Math.PI*t/a.length-Math.PI/2,s=e.value/100*105;return"".concat(150+s*Math.cos(r),",").concat(150+s*Math.sin(r))}).join(" "),s=Array.from({length:5}).map((e,t)=>{let s=21*(t+1),o=a.map((e,t)=>{let r=2*Math.PI*t/a.length-Math.PI/2;return"".concat(150+s*Math.cos(r),",").concat(150+s*Math.sin(r))}).join(" ");return(0,r.jsx)("polygon",{points:o,fill:"none",stroke:"currentColor",strokeOpacity:.1,strokeWidth:"1"},t)});return(0,r.jsx)("div",{className:"relative w-full max-w-sm mx-auto aspect-square text-foreground flex items-center justify-center",children:(0,r.jsxs)("svg",{width:"100%",height:"100%",viewBox:"0 0 ".concat(300," ").concat(300),children:[s,a.map((e,t)=>{let s=2*Math.PI*t/a.length-Math.PI/2;return(0,r.jsx)("line",{x1:150,y1:150,x2:150+105*Math.cos(s),y2:150+105*Math.sin(s),stroke:"currentColor",strokeOpacity:.1,strokeWidth:"1"},t)}),(0,r.jsx)("polygon",{points:t,fill:"#10b981",fillOpacity:.3,stroke:"#10b981",strokeWidth:"3"}),a.map((e,t)=>{let s=2*Math.PI*t/a.length-Math.PI/2,o=e.value/100*105;return(0,r.jsx)("circle",{cx:150+o*Math.cos(s),cy:150+o*Math.sin(s),r:"4",fill:"#10b981"},t)}),a.map((e,t)=>{let s=2*Math.PI*t/a.length-Math.PI/2,o=150+131.25*Math.cos(s),l=150+131.25*Math.sin(s);return(0,r.jsxs)("text",{x:o,y:l,fill:"currentColor",fontSize:"12",fontWeight:"bold",textAnchor:"middle",dominantBaseline:"middle",children:[(0,r.jsx)("tspan",{x:o,dy:"-5",children:e.label}),(0,r.jsx)("tspan",{x:o,dy:"15",fill:"#10b981",children:e.value})]},t)})]})})}},17238:(e,a,t)=>{Promise.resolve().then(t.bind(t,22391)),Promise.resolve().then(t.bind(t,13697)),Promise.resolve().then(t.t.bind(t,52619,23))},22391:(e,a,t)=>{"use strict";t.d(a,{EditableAvatar:()=>u});var r=t(95155),s=t(12115),o=t(15239),l=t(35299);let i=(0,t(71847).A)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var n=t(3941),c=t(18720),d=t(20063);function u(e){let{jugadorId:a,currentFotoUrl:t,jugadorNombre:u}=e,h="https://ui-avatars.com/api/?name=".concat(encodeURIComponent(u),"&background=0D8ABC&color=fff&size=200"),[p,m]=(0,s.useState)(t||h),[f,b]=(0,s.useState)(!1),[x,g]=(0,s.useState)(!1),v=(0,s.useRef)(null),y=(0,d.useRouter)();(0,s.useEffect)(()=>{m(t||h)},[t,h]),(0,s.useEffect)(()=>{(async()=>{let{data:{session:e}}=await n.N.auth.getSession();if(e){let{data:t}=await n.N.from("usuarios").select("rol, jugador_id").eq("id",e.user.id).single();((null==t?void 0:t.rol)==="admin"||(null==t?void 0:t.jugador_id)===a)&&g(!0)}})()},[a]);let j=async e=>{try{if(b(!0),!e.target.files||0===e.target.files.length)throw Error("Debes seleccionar una imagen para subir.");let t=e.target.files[0],r=t.name.split(".").pop(),s="avatars/".concat(a,"-").concat(Math.random(),".").concat(r),{error:o,data:l}=await n.N.storage.from("galeria").upload(s,t,{upsert:!0});if(o)throw o;let{data:i}=n.N.storage.from("galeria").getPublicUrl(s),d=i.publicUrl,u=await fetch("/api/players/avatar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jugador_id:a,foto_url:d})});if(!u.ok){let e=await u.json();throw Error(e.error||"Error actualizando el perfil del jugador")}m(d),c.o.success("Foto de perfil actualizada correctamente"),y.refresh()}catch(e){console.error("Error uploading avatar:",e),c.o.error(e.message||"No se pudo subir la foto de perfil.")}finally{b(!1),v.current&&(v.current.value="")}};return(0,r.jsxs)("div",{className:"relative h-48 w-48 sm:h-64 sm:w-64 rounded-2xl overflow-hidden border-4 border-card shadow-xl ring-4 ring-accent/20 bg-muted group",children:[(0,r.jsx)(o.default,{src:p,alt:u,fill:!0,className:"object-cover transition-transform duration-300 group-hover:scale-105"}),x&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:(0,r.jsxs)("button",{onClick:()=>{var e;return null==(e=v.current)?void 0:e.click()},disabled:f,className:"bg-accent/90 hover:bg-accent text-accent-foreground rounded-full p-4 shadow-lg transform transition-transform hover:scale-110 flex flex-col items-center justify-center",children:[f?(0,r.jsx)(l.A,{className:"h-8 w-8 animate-spin"}):(0,r.jsx)(i,{className:"h-8 w-8"}),(0,r.jsx)("span",{className:"text-xs font-bold mt-1",children:f?"Subiendo...":"Cambiar Foto"})]})}),(0,r.jsx)("input",{type:"file",ref:v,accept:"image/*",className:"hidden",onChange:j,disabled:f})]})]})}},35299:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(71847).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},46046:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(71847).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])}},e=>{e.O(0,[174,867,619,720,441,255,358],()=>e(e.s=17238)),_N_E=e.O()}]);