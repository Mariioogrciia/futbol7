{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mario/PycharmProjects/futbol7/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n\r\n// Cliente para el cliente (navegador) - usa clave an√≥nima\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\r\n\r\n// Tipos para TypeScript\r\nexport interface Usuario {\r\n  id: string\r\n  email: string\r\n  nombre: string\r\n  rol: 'admin' | 'equipo' | 'externo'\r\n  equipo_id?: string\r\n  created_at: string\r\n}\r\n\r\nexport interface Equipo {\r\n  id: string\r\n  nombre: string\r\n  user_id: string\r\n  temporada: number\r\n  descripcion?: string\r\n  ciudad?: string\r\n  created_at: string\r\n}\r\n\r\nexport interface Jugador {\r\n  id: string\r\n  equipo_id: string\r\n  nombre: string\r\n  posicion: string\r\n  dorsal?: number\r\n  goles: number\r\n  created_at: string\r\n}\r\n\r\nexport interface Partido {\r\n  id: string\r\n  equipo_id: string\r\n  rival: string\r\n  fecha: string\r\n  estado: 'programado' | 'en_vivo' | 'finalizado'\r\n  goles_equipo: number\r\n  goles_rival: number\r\n  goleadores: { jugador: string; goles: number }[]\r\n  resultado?: string\r\n  notas?: string\r\n  created_at: string\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAGC,MAAM,WAAW,IAAA,8LAAY,EAAC,aAAa","debugId":null}},
    {"offset": {"line": 17, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mario/PycharmProjects/futbol7/app/jugador/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { Loader2, CalendarHeart, XCircle, CheckCircle2, ChevronDown, User } from \"lucide-react\";\r\n\r\nconst EQUIPO_ID = \"7ec6e1c6-9704-496c-ae72-a590817b9568\";\r\n\r\nexport default function PlayerPortal() {\r\n    const router = useRouter();\r\n    const [user, setUser] = useState<any>(null);\r\n    const [jugadorId, setJugadorId] = useState<string | null>(null);\r\n    const [nextMatch, setNextMatch] = useState<any>(null);\r\n    const [asistencia, setAsistencia] = useState<boolean | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Team State for shared logins\r\n    const [players, setPlayers] = useState<any[]>([]);\r\n    const [loadingRSVP, setLoadingRSVP] = useState(false);\r\n    const [toastMessage, setToastMessage] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        checkAuthAndFetch();\r\n    }, []);\r\n\r\n    async function checkAuthAndFetch() {\r\n        try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            if (!session) {\r\n                router.push(\"/\");\r\n                return;\r\n            }\r\n\r\n            const { data: userData } = await supabase\r\n                .from('usuarios')\r\n                .select('*')\r\n                .eq('id', session.user.id)\r\n                .single();\r\n\r\n            if (!userData || userData.rol !== \"equipo\") {\r\n                console.error(\"Role mismatch or user missing\", userData);\r\n                router.push(\"/\");\r\n                return;\r\n            }\r\n\r\n            setUser(session.user);\r\n            // Attempt to retrieve a player id, if missing we will just warn instead of routing out.\r\n            setJugadorId(userData.jugador_id || null);\r\n\r\n            // Fetch next match and Team Roster\r\n            const [matchesRes, playersRes] = await Promise.all([\r\n                supabase\r\n                    .from('partidos')\r\n                    .select('*')\r\n                    .eq('estado', 'programado')\r\n                    .order('fecha', { ascending: true })\r\n                    .limit(1),\r\n                fetch(`/api/players?equipo_id=${EQUIPO_ID}&t=${Date.now()}`)\r\n            ]);\r\n\r\n            const matches = matchesRes.data;\r\n            if (playersRes.ok) {\r\n                const pData = await playersRes.json();\r\n                setPlayers(pData.jugadores || []);\r\n            }\r\n\r\n            if (matches && matches.length > 0) {\r\n                const match = matches[0];\r\n                setNextMatch(match);\r\n\r\n                // Fetch existing rsvp if any\r\n                if (userData.jugador_id) {\r\n                    const { data: rsvp } = await supabase\r\n                        .from('convocatorias')\r\n                        .select('asiste')\r\n                        .eq('partido_id', match.id)\r\n                        .eq('jugador_id', userData.jugador_id)\r\n                        .single();\r\n\r\n                    if (rsvp) setAsistencia(rsvp.asiste);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error(error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    const handlePlayerSelect = async (id: string) => {\r\n        setJugadorId(id);\r\n        const player = players.find(p => p.id === id);\r\n        if (player) {\r\n            // Check if this newly selected player has already voted\r\n            if (nextMatch) {\r\n                const { data: rsvp } = await supabase\r\n                    .from('convocatorias')\r\n                    .select('asiste')\r\n                    .eq('partido_id', nextMatch.id)\r\n                    .eq('jugador_id', id)\r\n                    .single();\r\n\r\n                setAsistencia(rsvp ? rsvp.asiste : null);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleRSVP = async (going: boolean) => {\r\n        if (!jugadorId || !nextMatch) {\r\n            alert(\"Selecciona tu nombre primero arriba üëÜ\");\r\n            return;\r\n        }\r\n\r\n        setLoadingRSVP(true);\r\n        const optimisticPrev = asistencia;\r\n        setAsistencia(going); // Optimistic UI\r\n\r\n        try {\r\n            // Upsert logic\r\n            const { error } = await supabase\r\n                .from('convocatorias')\r\n                .upsert({\r\n                    partido_id: nextMatch.id,\r\n                    jugador_id: jugadorId,\r\n                    asiste: going\r\n                }, { onConflict: 'partido_id, jugador_id' });\r\n\r\n            if (error) throw error;\r\n\r\n            // Show Success Message\r\n            setToastMessage(\"¬°Asistencia registrada correctamente!\");\r\n            setTimeout(() => setToastMessage(null), 3500);\r\n\r\n        } catch (e) {\r\n            console.error(\"Error setting RSVP:\", e);\r\n            alert(\"Error al guardar asistencia. Intenta de nuevo.\");\r\n            setAsistencia(optimisticPrev); // Revert\r\n        } finally {\r\n            setLoadingRSVP(false);\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return <div className=\"min-h-screen bg-background flex items-center justify-center\"><Loader2 className=\"animate-spin text-primary h-8 w-8\" /></div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-background text-foreground pt-24 pb-12 px-4 relative\">\r\n\r\n            {/* Toast Notification */}\r\n            {toastMessage && (\r\n                <div className=\"fixed top-24 left-1/2 transform -translate-x-1/2 z-50 animate-in fade-in slide-in-from-top-4 duration-300\">\r\n                    <div className=\"bg-emerald-500 text-white px-6 py-3 rounded-full font-bold shadow-lg shadow-emerald-500/20 flex items-center gap-2 border border-emerald-400\">\r\n                        <CheckCircle2 className=\"h-5 w-5\" />\r\n                        {toastMessage}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"max-w-3xl mx-auto space-y-8\">\r\n\r\n                {/* Header */}\r\n                <div className=\"bg-card/50 backdrop-blur border border-border rounded-3xl p-8 shadow-sm\">\r\n                    <h1 className=\"text-3xl font-extrabold mb-2\">Portal del Jugador</h1>\r\n                    <p className=\"text-muted-foreground\">Bienvenido a tu panel personal de la plantilla.</p>\r\n                </div>\r\n\r\n                {/* Next Match Card */}\r\n                {nextMatch ? (\r\n                    <div className=\"bg-card border border-border rounded-3xl overflow-hidden shadow-lg\">\r\n                        <div className=\"bg-primary/10 border-b border-border p-6 flex items-center justify-between\">\r\n                            <h2 className=\"text-xl font-bold flex items-center gap-2\">\r\n                                <CalendarHeart className=\"h-6 w-6 text-primary\" />\r\n                                Pr√≥xima Convocatoria\r\n                            </h2>\r\n                            <span className=\"bg-primary text-primary-foreground text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider\">\r\n                                Pendiente\r\n                            </span>\r\n                        </div>\r\n\r\n                        <div className=\"p-8 text-center space-y-6\">\r\n                            <div>\r\n                                <p className=\"text-sm font-bold text-muted-foreground uppercase tracking-widest mb-2\">Jornada vs</p>\r\n                                <p className=\"text-4xl font-black\">{nextMatch.rival}</p>\r\n                                <p className=\"text-muted-foreground mt-4 text-lg\">\r\n                                    üìÖ {new Date(nextMatch.fecha).toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}\r\n                                </p>\r\n                            </div>\r\n\r\n                            <div className=\"pt-8 border-t border-border mt-8\">\r\n                                <div className=\"mb-8\">\r\n                                    <label className=\"block text-sm font-bold text-muted-foreground uppercase tracking-widest mb-3 text-left max-w-md mx-auto\">\r\n                                        ¬øQui√©n eres?\r\n                                    </label>\r\n                                    <div className=\"relative max-w-md mx-auto\">\r\n                                        <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                                            <User className=\"h-5 w-5 text-muted-foreground\" />\r\n                                        </div>\r\n                                        <select\r\n                                            className=\"w-full appearance-none bg-background border border-border text-foreground py-3 pl-10 pr-10 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all\"\r\n                                            value={jugadorId || \"\"}\r\n                                            onChange={(e) => handlePlayerSelect(e.target.value)}\r\n                                        >\r\n                                            <option value=\"\" disabled>-- Selecciona tu nombre --</option>\r\n                                            {players.map(p => (\r\n                                                <option key={p.id} value={p.id}>{p.dorsal} - {p.nombre}</option>\r\n                                            ))}\r\n                                        </select>\r\n                                        <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\r\n                                            <ChevronDown className=\"h-5 w-5 text-muted-foreground\" />\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <h3 className=\"text-lg font-bold mb-6\">¬øVas a asistir al partido?</h3>\r\n\r\n                                <div className=\"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto\">\r\n                                    <button\r\n                                        onClick={() => handleRSVP(true)}\r\n                                        disabled={!jugadorId || loadingRSVP}\r\n                                        className={`flex-1 flex items-center justify-center gap-2 py-4 px-6 rounded-2xl font-bold text-lg transition-all ${asistencia === true ? 'bg-emerald-500 text-white shadow-lg shadow-emerald-500/20 ring-2 ring-emerald-500 ring-offset-2 ring-offset-background' : 'bg-secondary hover:bg-emerald-500/10 hover:text-emerald-500'} disabled:opacity-50 disabled:cursor-not-allowed`}\r\n                                    >\r\n                                        <CheckCircle2 className=\"h-6 w-6\" />\r\n                                        Asistir√©\r\n                                    </button>\r\n\r\n                                    <button\r\n                                        onClick={() => handleRSVP(false)}\r\n                                        disabled={!jugadorId || loadingRSVP}\r\n                                        className={`flex-1 flex items-center justify-center gap-2 py-4 px-6 rounded-2xl font-bold text-lg transition-all ${asistencia === false ? 'bg-red-500 text-white shadow-lg shadow-red-500/20 ring-2 ring-red-500 ring-offset-2 ring-offset-background' : 'bg-secondary hover:bg-red-500/10 hover:text-red-500'} disabled:opacity-50 disabled:cursor-not-allowed`}\r\n                                    >\r\n                                        <XCircle className=\"h-6 w-6\" />\r\n                                        No ir√©\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"bg-card border border-border border-dashed rounded-3xl p-12 text-center\">\r\n                        <span className=\"text-4xl opacity-50 mb-4 block\">üèùÔ∏è</span>\r\n                        <h3 className=\"text-xl font-bold text-foreground\">No hay pr√≥ximos partidos</h3>\r\n                        <p className=\"text-muted-foreground mt-2\">El calendario est√° libre. Disfruta del descanso.</p>\r\n                    </div>\r\n                )}\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}